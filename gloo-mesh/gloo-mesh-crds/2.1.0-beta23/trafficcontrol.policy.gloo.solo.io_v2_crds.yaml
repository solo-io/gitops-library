# Code generated by skv2. DO NOT EDIT.

apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    crd.solo.io/specHash: 672b207c356486b8
    crd.solo.io/version: 2.1.0
  labels:
    app: gloo-mesh-apis
    app.kubernetes.io/name: gloo-mesh-apis
  name: mirrorpolicies.trafficcontrol.policy.gloo.solo.io
spec:
  group: trafficcontrol.policy.gloo.solo.io
  names:
    categories:
    - solo-io
    kind: MirrorPolicy
    listKind: MirrorPolicyList
    plural: mirrorpolicies
    shortNames:
    - mp
    singular: mirrorpolicy
  scope: Namespaced
  versions:
  - name: v2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: |-
              MirrorPolicy is used to mirror/shadow traffic to a another destination (traffic will be sent to its original destination in addition to the mirrored destinations).
              MirrorPolicies are applied at the *Route* level.
            properties:
              applyToRoutes:
                description: |-
                  select the routes where the policy will be applied
                  if left empty, will apply to all routes in the workspace.
                items:
                  oneOf:
                  - not:
                      anyOf:
                      - required:
                        - route
                      - required:
                        - withDestinations
                  - required:
                    - route
                  - required:
                    - withDestinations
                  properties:
                    route:
                      description: |-
                        select routes based on their labels.
                        these labels can be used to match route tables or individual routes within route tables.
                      properties:
                        cluster:
                          description: |-
                            Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                            matching objects across all clusters available in the parent object's workspace.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: labels matching those of the object
                          type: object
                        name:
                          description: |-
                            Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                            matching objects with any name available in the parent object's workspace.
                          type: string
                        namespace:
                          description: |-
                            Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                            matching objects across all namespaces available in the parent object's workspace.
                          type: string
                        workspace:
                          description: |-
                            Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                            matching objects across all workspaces available in the parent object's workspace.
                          type: string
                      type: object
                    withDestinations:
                      description: |-
                        select routes with `forwardTo` actions based on their destinations.
                        this can be used to apply policy to routes regardless of
                        their labels
                      properties:
                        kind:
                          description: the kind of destination being selected. defaults
                            to Kubernetes Service.
                          enum:
                          - SERVICE
                          - VIRTUAL_DESTINATION
                          - EXTERNAL_SERVICE
                          type: string
                        port:
                          description: |-
                            the port on the Destination which receives traffic.
                            Not required if the Destination only exposes a single port.
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - number
                              - required:
                                - name
                          - required:
                            - number
                          - required:
                            - name
                          properties:
                            name:
                              description: the name of the port on the destination
                                objects being targeted.
                              type: string
                            number:
                              description: the number of the port on the destination
                                objects being targeted.
                              maximum: 4294967295
                              minimum: 0
                              type: integer
                          type: object
                        selector:
                          description: selector used to match destination objects
                            by their metadata
                          properties:
                            cluster:
                              description: |-
                                Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                                matching objects across all clusters available in the parent object's workspace.
                              type: string
                            labels:
                              additionalProperties:
                                type: string
                              description: labels matching those of the object
                              type: object
                            name:
                              description: |-
                                Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                                matching objects with any name available in the parent object's workspace.
                              type: string
                            namespace:
                              description: |-
                                Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                                matching objects across all namespaces available in the parent object's workspace.
                              type: string
                            workspace:
                              description: |-
                                Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                                matching objects across all workspaces available in the parent object's workspace.
                              type: string
                          type: object
                      type: object
                  type: object
                type: array
              config:
                description: The details of the Mirror policy to apply to the selected
                  routes
                properties:
                  destination:
                    description: The destination to which to send mirrored traffic
                    properties:
                      kind:
                        description: the kind of destination being selected. defaults
                          to Kubernetes Service.
                        enum:
                        - SERVICE
                        - VIRTUAL_DESTINATION
                        - EXTERNAL_SERVICE
                        type: string
                      port:
                        description: the port on the destination object being targeted.
                          required if the object provides more than one port.
                        oneOf:
                        - not:
                            anyOf:
                            - required:
                              - number
                            - required:
                              - name
                        - required:
                          - number
                        - required:
                          - name
                        properties:
                          name:
                            description: the name of the port on the destination objects
                              being targeted.
                            type: string
                          number:
                            description: the number of the port on the destination
                              objects being targeted.
                            maximum: 4294967295
                            minimum: 0
                            type: integer
                        type: object
                      ref:
                        description: reference to the destination object by its metadata
                        properties:
                          cluster:
                            description: the cluster of the object. if the field is
                              omitted, Gloo Mesh will use the same cluster as the
                              parent object containing this reference.
                            type: string
                          name:
                            description: the name of the object
                            type: string
                          namespace:
                            description: the namespace of the object. if the field
                              is omitted, Gloo Mesh will use the same namespace as
                              the parent object containing this reference.
                            type: string
                        type: object
                      subset:
                        additionalProperties:
                          type: string
                        description: select a subset of the destination's endpoints
                          for routing based on their labels.
                        type: object
                      weight:
                        description: |-
                          Specify the proportion of traffic to be forwarded to this destination.
                          Weights across all of the `destinations` must sum to 100.
                          Weight is only relevant when used in the context of a route with multiple destinations.
                        maximum: 4294967295
                        minimum: 0
                        type: integer
                    type: object
                  percentage:
                    description: Percentage of traffic to mirror. If omitted all traffic
                      will be mirrored. Values must be between 0 and 100.
                    nullable: true
                    type: number
                type: object
            type: object
          status:
            description: reflects the status of the MirrorPolicy
            properties:
              global:
                properties:
                  message:
                    description: |-
                      Additional information about the current state of the resource across all
                      workspace clusters.
                    type: string
                  state:
                    description: |-
                      Whether the resource has been accepted as valid and processed in workspace
                      clusters that it exists in.
                    enum:
                    - PENDING
                    - ACCEPTED
                    - INVALID
                    - WARNING
                    - FAILED
                    - UNLICENSED
                    type: string
                type: object
              selectedRoutes:
                description: Routes selected by the policy
                items:
                  properties:
                    routeIndex:
                      description: The index of the route on the route table
                      format: int32
                      type: integer
                    routeName:
                      description: The name of the route
                      type: string
                    routeTable:
                      description: The route table containing the route
                      properties:
                        cluster:
                          description: the cluster of the object. if the field is
                            omitted, Gloo Mesh will use the same cluster as the parent
                            object containing this reference.
                          type: string
                        name:
                          description: the name of the object
                          type: string
                        namespace:
                          description: the namespace of the object. if the field is
                            omitted, Gloo Mesh will use the same namespace as the
                            parent object containing this reference.
                          type: string
                      type: object
                  type: object
                type: array
              workspaces:
                additionalProperties:
                  properties:
                    clusters:
                      additionalProperties:
                        properties:
                          generic:
                            properties:
                              message:
                                description: Additional information about the current
                                  state of the resource.
                                type: string
                              observedGeneration:
                                description: |-
                                  The most recent generation observed in the the object's metadata.
                                  If the `observedGeneration` does not match `metadata.generation`, Gloo Mesh
                                  has not processed the most recent version of this object.
                                format: int64
                                type: integer
                              state:
                                description: |-
                                  Whether the resource has been accepted as valid and processed in the Gloo
                                  Mesh config translation.
                                enum:
                                - PENDING
                                - ACCEPTED
                                - INVALID
                                - WARNING
                                - FAILED
                                - UNLICENSED
                                type: string
                              updatedAt:
                                description: The last time the status was updated.
                                format: date-time
                                type: string
                            type: object
                        type: object
                      description: |-
                        The status of the resource in each cluster within the
                        workspace.
                      type: object
                  type: object
                description: The status of the resource in each workspace that it
                  exists in.
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    crd.solo.io/specHash: 2fadf48d634560d1
    crd.solo.io/version: 2.1.0
  labels:
    app: gloo-mesh-apis
    app.kubernetes.io/name: gloo-mesh-apis
  name: ratelimitpolicies.trafficcontrol.policy.gloo.solo.io
spec:
  group: trafficcontrol.policy.gloo.solo.io
  names:
    categories:
    - solo-io
    kind: RateLimitPolicy
    listKind: RateLimitPolicyList
    plural: ratelimitpolicies
    shortNames:
    - rlp
    singular: ratelimitpolicy
  scope: Namespaced
  versions:
  - name: v2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: |-
              RateLimitPolicy is used to assign ratelimit configuration to specific routes or destinations.
              Traffic is forwarded to a rate-limited destinations specified in the RatelimitServerSettings.
              The RatelimitServerSettings is also used to configure connecting settings.
              If this is not provided, the default connection settings and default gloo mesh ratelimiter server destination will be used.
              RateLimitPolicies are applied at the *Route* level and *Destination* levels.
              Default is to apply policy to all destinations.
            properties:
              applyToDestinations:
                description: |-
                  Select the destinations where the policy will be applied.
                  Default behavior if no selectors are specified is to apply to all destinations in the workspace.
                  If left empty and the route selector is set, no ratelimits on destinations will be applied.
                items:
                  properties:
                    kind:
                      description: the kind of destination being selected. defaults
                        to Kubernetes Service.
                      enum:
                      - SERVICE
                      - VIRTUAL_DESTINATION
                      - EXTERNAL_SERVICE
                      type: string
                    port:
                      description: |-
                        the port on the Destination which receives traffic.
                        Not required if the Destination only exposes a single port.
                      oneOf:
                      - not:
                          anyOf:
                          - required:
                            - number
                          - required:
                            - name
                      - required:
                        - number
                      - required:
                        - name
                      properties:
                        name:
                          description: the name of the port on the destination objects
                            being targeted.
                          type: string
                        number:
                          description: the number of the port on the destination objects
                            being targeted.
                          maximum: 4294967295
                          minimum: 0
                          type: integer
                      type: object
                    selector:
                      description: selector used to match destination objects by their
                        metadata
                      properties:
                        cluster:
                          description: |-
                            Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                            matching objects across all clusters available in the parent object's workspace.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: labels matching those of the object
                          type: object
                        name:
                          description: |-
                            Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                            matching objects with any name available in the parent object's workspace.
                          type: string
                        namespace:
                          description: |-
                            Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                            matching objects across all namespaces available in the parent object's workspace.
                          type: string
                        workspace:
                          description: |-
                            Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                            matching objects across all workspaces available in the parent object's workspace.
                          type: string
                      type: object
                  type: object
                type: array
              applyToRoutes:
                description: |-
                  Select the routes where the policy will be applied.
                  If left empty, no ratelimits on routes will be applied in the workspace.
                items:
                  oneOf:
                  - not:
                      anyOf:
                      - required:
                        - route
                      - required:
                        - withDestinations
                  - required:
                    - route
                  - required:
                    - withDestinations
                  properties:
                    route:
                      description: |-
                        select routes based on their labels.
                        these labels can be used to match route tables or individual routes within route tables.
                      properties:
                        cluster:
                          description: |-
                            Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                            matching objects across all clusters available in the parent object's workspace.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: labels matching those of the object
                          type: object
                        name:
                          description: |-
                            Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                            matching objects with any name available in the parent object's workspace.
                          type: string
                        namespace:
                          description: |-
                            Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                            matching objects across all namespaces available in the parent object's workspace.
                          type: string
                        workspace:
                          description: |-
                            Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                            matching objects across all workspaces available in the parent object's workspace.
                          type: string
                      type: object
                    withDestinations:
                      description: |-
                        select routes with `forwardTo` actions based on their destinations.
                        this can be used to apply policy to routes regardless of
                        their labels
                      properties:
                        kind:
                          description: the kind of destination being selected. defaults
                            to Kubernetes Service.
                          enum:
                          - SERVICE
                          - VIRTUAL_DESTINATION
                          - EXTERNAL_SERVICE
                          type: string
                        port:
                          description: |-
                            the port on the Destination which receives traffic.
                            Not required if the Destination only exposes a single port.
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - number
                              - required:
                                - name
                          - required:
                            - number
                          - required:
                            - name
                          properties:
                            name:
                              description: the name of the port on the destination
                                objects being targeted.
                              type: string
                            number:
                              description: the number of the port on the destination
                                objects being targeted.
                              maximum: 4294967295
                              minimum: 0
                              type: integer
                          type: object
                        selector:
                          description: selector used to match destination objects
                            by their metadata
                          properties:
                            cluster:
                              description: |-
                                Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                                matching objects across all clusters available in the parent object's workspace.
                              type: string
                            labels:
                              additionalProperties:
                                type: string
                              description: labels matching those of the object
                              type: object
                            name:
                              description: |-
                                Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                                matching objects with any name available in the parent object's workspace.
                              type: string
                            namespace:
                              description: |-
                                Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                                matching objects across all namespaces available in the parent object's workspace.
                              type: string
                            workspace:
                              description: |-
                                Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                                matching objects across all workspaces available in the parent object's workspace.
                              type: string
                          type: object
                      type: object
                  type: object
                type: array
              config:
                description: The configuration details of the rate limit policy to
                  apply to the selected routes
                oneOf:
                - not:
                    anyOf:
                    - required:
                      - raw
                    - required:
                      - ratelimitClientConfig
                - required:
                  - raw
                - required:
                  - ratelimitClientConfig
                properties:
                  phase:
                    description: |-
                      Specify the phase to indicate where this policy should be applied relative to other policies.
                      If no phase is specified, the default will be post AuthZ.
                    oneOf:
                    - not:
                        anyOf:
                        - required:
                          - preAuthz
                        - required:
                          - postAuthz
                    - required:
                      - preAuthz
                    - required:
                      - postAuthz
                    properties:
                      postAuthz:
                        description: Apply this policy after Authorization policies
                          are applied.
                        properties:
                          priority:
                            description: |-
                              The priority at which this policy should be applied relative to other policies defined in the same phase.
                              The lowest priority will be run first and the default priority value is 0.
                            maximum: 2147483647
                            minimum: -2147483648
                            nullable: true
                            type: integer
                        type: object
                      preAuthz:
                        description: Apply this policy before Authorization policies
                          are applied.
                        properties:
                          priority:
                            description: |-
                              The priority at which this policy should be applied relative to other policies defined in the same phase.
                              The lowest priority will be run first and the default priority value is 0.
                            maximum: 2147483647
                            minimum: -2147483648
                            nullable: true
                            type: integer
                        type: object
                    type: object
                  ratelimitClientConfig:
                    description: Select a RatelimitClientConfig policy to apply.
                    properties:
                      cluster:
                        description: the cluster of the object. if the field is omitted,
                          Gloo Mesh will use the same cluster as the parent object
                          containing this reference.
                        type: string
                      name:
                        description: the name of the object
                        type: string
                      namespace:
                        description: the namespace of the object. if the field is
                          omitted, Gloo Mesh will use the same namespace as the parent
                          object containing this reference.
                        type: string
                    type: object
                  ratelimitServerConfig:
                    description: |-
                      Reference to the RatelimitServerConfig to use for this policy.
                      If none is provided, no ratelimit will be enforced
                    properties:
                      cluster:
                        description: the cluster of the object. if the field is omitted,
                          Gloo Mesh will use the same cluster as the parent object
                          containing this reference.
                        type: string
                      name:
                        description: the name of the object
                        type: string
                      namespace:
                        description: the namespace of the object. if the field is
                          omitted, Gloo Mesh will use the same namespace as the parent
                          object containing this reference.
                        type: string
                    type: object
                  raw:
                    description: Inline a policy using the raw configuration format
                      used by the ratelimit server.
                    properties:
                      rateLimits:
                        description: |-
                          Actions specify how the client (Envoy) will compose the descriptors that
                          will be sent to the server to make a rate limiting decision.
                        items:
                          properties:
                            actions:
                              items:
                                oneOf:
                                - not:
                                    anyOf:
                                    - required:
                                      - sourceCluster
                                    - required:
                                      - destinationCluster
                                    - required:
                                      - requestHeaders
                                    - required:
                                      - remoteAddress
                                    - required:
                                      - genericKey
                                    - required:
                                      - headerValueMatch
                                    - required:
                                      - metadata
                                - required:
                                  - sourceCluster
                                - required:
                                  - destinationCluster
                                - required:
                                  - requestHeaders
                                - required:
                                  - remoteAddress
                                - required:
                                  - genericKey
                                - required:
                                  - headerValueMatch
                                - required:
                                  - metadata
                                properties:
                                  destinationCluster:
                                    description: Rate limit on destination cluster.
                                    type: object
                                  genericKey:
                                    description: Rate limit on a generic key.
                                    properties:
                                      descriptorValue:
                                        description: The value to use in the descriptor
                                          entry.
                                        type: string
                                    type: object
                                  headerValueMatch:
                                    description: Rate limit on the existence of request
                                      headers.
                                    properties:
                                      descriptorValue:
                                        description: The value to use in the descriptor
                                          entry.
                                        type: string
                                      expectMatch:
                                        description: |-
                                          If set to true, the action will append a descriptor entry when the
                                          request matches the headers. If set to false, the action will append a
                                          descriptor entry when the request does not match the headers. The
                                          default value is true.
                                        nullable: true
                                        type: boolean
                                      headers:
                                        description: |-
                                          Specifies a set of headers that the rate limit action should match
                                          on. The action will check the request’s headers against all the
                                          specified headers in the config. A match will happen if all the
                                          headers in the config are present in the request with the same values
                                          (or based on presence if the value field is not in the config).
                                        items:
                                          oneOf:
                                          - not:
                                              anyOf:
                                              - required:
                                                - exactMatch
                                              - required:
                                                - regexMatch
                                              - required:
                                                - rangeMatch
                                              - required:
                                                - presentMatch
                                              - required:
                                                - prefixMatch
                                              - required:
                                                - suffixMatch
                                          - required:
                                            - exactMatch
                                          - required:
                                            - regexMatch
                                          - required:
                                            - rangeMatch
                                          - required:
                                            - presentMatch
                                          - required:
                                            - prefixMatch
                                          - required:
                                            - suffixMatch
                                          properties:
                                            exactMatch:
                                              description: If specified, header match
                                                will be performed based on the value
                                                of the header.
                                              type: string
                                            invertMatch:
                                              description: |-
                                                If specified, the match result will be inverted before checking. Defaults to false.

                                                Examples:

                                                * The regex *\d{3}* does not match the value *1234*, so it will match when inverted.
                                                * The range [-10,0) will match the value -1, so it will not match when inverted.
                                              type: boolean
                                            name:
                                              description: Specifies the name of the
                                                header in the request.
                                              type: string
                                            prefixMatch:
                                              description: |-
                                                If specified, header match will be performed based on the prefix of the header value.
                                                Note: empty prefix is not allowed, please use present_match instead.

                                                Examples:

                                                * The prefix *abcd* matches the value *abcdxyz*, but not for *abcxyz*.
                                              type: string
                                            presentMatch:
                                              description: |-
                                                If specified, header match will be performed based on whether the header is in the
                                                request.
                                              type: boolean
                                            rangeMatch:
                                              description: |-
                                                If specified, header match will be performed based on range.
                                                The rule will match if the request header value is within this range.
                                                The entire request header value must represent an integer in base 10 notation: consisting of
                                                an optional plus or minus sign followed by a sequence of digits. The rule will not match if
                                                the header value does not represent an integer. Match will fail for empty values, floating
                                                point numbers or if only a subsequence of the header value is an integer.

                                                Examples:

                                                * For range [-10,0), route will match for header value -1, but not for 0, "somestring", 10.9,
                                                  "-1somestring"
                                              properties:
                                                end:
                                                  description: end of the range (exclusive)
                                                  format: int64
                                                  type: integer
                                                start:
                                                  description: start of the range
                                                    (inclusive)
                                                  format: int64
                                                  type: integer
                                              type: object
                                            regexMatch:
                                              description: |-
                                                If specified, this regex string is a regular expression rule which implies the entire request
                                                header value must match the regex. The rule will not match if only a subsequence of the
                                                request header value matches the regex. The regex grammar used in the value field is defined
                                                `(here)[https://en.cppreference.com/w/cpp/regex/ecmascript]`.

                                                Examples:

                                                * The regex *\d{3}* matches the value *123*
                                                * The regex *\d{3}* does not match the value *1234*
                                                * The regex *\d{3}* does not match the value *123.456*
                                              type: string
                                            suffixMatch:
                                              description: |-
                                                If specified, header match will be performed based on the suffix of the header value.
                                                Note: empty suffix is not allowed, please use present_match instead.

                                                Examples:

                                                * The suffix *abcd* matches the value *xyzabcd*, but not for *xyzbcd*.
                                              type: string
                                          type: object
                                        type: array
                                    type: object
                                  metadata:
                                    description: Rate limit on metadata.
                                    properties:
                                      defaultValue:
                                        description: |-
                                          An optional value to use if *metadata_key* is empty. If not set and
                                          no value is present under the metadata_key then no descriptor is generated.
                                        type: string
                                      descriptorKey:
                                        description: Required. The key to use in the
                                          descriptor entry.
                                        type: string
                                      metadataKey:
                                        description: |-
                                          Required. Metadata struct that defines the key and path to retrieve the string value. A match will
                                          only happen if the value in the metadata is of type string.
                                        properties:
                                          key:
                                            description: |-
                                              Required. The key name of Metadata to retrieve the Struct from the metadata.
                                              Typically, it represents a builtin subsystem or custom extension.
                                            type: string
                                          path:
                                            description: |-
                                              Must have at least one element. The path to retrieve the Value from the Struct. It can be a prefix or a full path,
                                              e.g. ``[prop, xyz]`` for a struct or ``[prop, foo]`` for a string in the example,
                                              which depends on the particular scenario.

                                              Note: Due to that only the key type segment is supported, the path can not specify a list
                                              unless the list is the last segment.
                                            items:
                                              oneOf:
                                              - not:
                                                  anyOf:
                                                  - required:
                                                    - key
                                              - required:
                                                - key
                                              properties:
                                                key:
                                                  description: Required. If specified,
                                                    use the key to retrieve the value
                                                    in a Struct.
                                                  type: string
                                              type: object
                                            type: array
                                        type: object
                                      source:
                                        description: Source of metadata
                                        enum:
                                        - DYNAMIC
                                        - ROUTE_ENTRY
                                        type: string
                                    type: object
                                  remoteAddress:
                                    description: Rate limit on remote address.
                                    type: object
                                  requestHeaders:
                                    description: Rate limit on request headers.
                                    properties:
                                      descriptorKey:
                                        description: The key to use in the descriptor
                                          entry.
                                        type: string
                                      headerName:
                                        description: |-
                                          The header name to be queried from the request headers. The header’s
                                          value is used to populate the value of the descriptor entry for the
                                          descriptor_key.
                                        type: string
                                    type: object
                                  sourceCluster:
                                    description: Rate limit on source cluster.
                                    type: object
                                type: object
                              type: array
                            setActions:
                              items:
                                oneOf:
                                - not:
                                    anyOf:
                                    - required:
                                      - sourceCluster
                                    - required:
                                      - destinationCluster
                                    - required:
                                      - requestHeaders
                                    - required:
                                      - remoteAddress
                                    - required:
                                      - genericKey
                                    - required:
                                      - headerValueMatch
                                    - required:
                                      - metadata
                                - required:
                                  - sourceCluster
                                - required:
                                  - destinationCluster
                                - required:
                                  - requestHeaders
                                - required:
                                  - remoteAddress
                                - required:
                                  - genericKey
                                - required:
                                  - headerValueMatch
                                - required:
                                  - metadata
                                properties:
                                  destinationCluster:
                                    description: Rate limit on destination cluster.
                                    type: object
                                  genericKey:
                                    description: Rate limit on a generic key.
                                    properties:
                                      descriptorValue:
                                        description: The value to use in the descriptor
                                          entry.
                                        type: string
                                    type: object
                                  headerValueMatch:
                                    description: Rate limit on the existence of request
                                      headers.
                                    properties:
                                      descriptorValue:
                                        description: The value to use in the descriptor
                                          entry.
                                        type: string
                                      expectMatch:
                                        description: |-
                                          If set to true, the action will append a descriptor entry when the
                                          request matches the headers. If set to false, the action will append a
                                          descriptor entry when the request does not match the headers. The
                                          default value is true.
                                        nullable: true
                                        type: boolean
                                      headers:
                                        description: |-
                                          Specifies a set of headers that the rate limit action should match
                                          on. The action will check the request’s headers against all the
                                          specified headers in the config. A match will happen if all the
                                          headers in the config are present in the request with the same values
                                          (or based on presence if the value field is not in the config).
                                        items:
                                          oneOf:
                                          - not:
                                              anyOf:
                                              - required:
                                                - exactMatch
                                              - required:
                                                - regexMatch
                                              - required:
                                                - rangeMatch
                                              - required:
                                                - presentMatch
                                              - required:
                                                - prefixMatch
                                              - required:
                                                - suffixMatch
                                          - required:
                                            - exactMatch
                                          - required:
                                            - regexMatch
                                          - required:
                                            - rangeMatch
                                          - required:
                                            - presentMatch
                                          - required:
                                            - prefixMatch
                                          - required:
                                            - suffixMatch
                                          properties:
                                            exactMatch:
                                              description: If specified, header match
                                                will be performed based on the value
                                                of the header.
                                              type: string
                                            invertMatch:
                                              description: |-
                                                If specified, the match result will be inverted before checking. Defaults to false.

                                                Examples:

                                                * The regex *\d{3}* does not match the value *1234*, so it will match when inverted.
                                                * The range [-10,0) will match the value -1, so it will not match when inverted.
                                              type: boolean
                                            name:
                                              description: Specifies the name of the
                                                header in the request.
                                              type: string
                                            prefixMatch:
                                              description: |-
                                                If specified, header match will be performed based on the prefix of the header value.
                                                Note: empty prefix is not allowed, please use present_match instead.

                                                Examples:

                                                * The prefix *abcd* matches the value *abcdxyz*, but not for *abcxyz*.
                                              type: string
                                            presentMatch:
                                              description: |-
                                                If specified, header match will be performed based on whether the header is in the
                                                request.
                                              type: boolean
                                            rangeMatch:
                                              description: |-
                                                If specified, header match will be performed based on range.
                                                The rule will match if the request header value is within this range.
                                                The entire request header value must represent an integer in base 10 notation: consisting of
                                                an optional plus or minus sign followed by a sequence of digits. The rule will not match if
                                                the header value does not represent an integer. Match will fail for empty values, floating
                                                point numbers or if only a subsequence of the header value is an integer.

                                                Examples:

                                                * For range [-10,0), route will match for header value -1, but not for 0, "somestring", 10.9,
                                                  "-1somestring"
                                              properties:
                                                end:
                                                  description: end of the range (exclusive)
                                                  format: int64
                                                  type: integer
                                                start:
                                                  description: start of the range
                                                    (inclusive)
                                                  format: int64
                                                  type: integer
                                              type: object
                                            regexMatch:
                                              description: |-
                                                If specified, this regex string is a regular expression rule which implies the entire request
                                                header value must match the regex. The rule will not match if only a subsequence of the
                                                request header value matches the regex. The regex grammar used in the value field is defined
                                                `(here)[https://en.cppreference.com/w/cpp/regex/ecmascript]`.

                                                Examples:

                                                * The regex *\d{3}* matches the value *123*
                                                * The regex *\d{3}* does not match the value *1234*
                                                * The regex *\d{3}* does not match the value *123.456*
                                              type: string
                                            suffixMatch:
                                              description: |-
                                                If specified, header match will be performed based on the suffix of the header value.
                                                Note: empty suffix is not allowed, please use present_match instead.

                                                Examples:

                                                * The suffix *abcd* matches the value *xyzabcd*, but not for *xyzbcd*.
                                              type: string
                                          type: object
                                        type: array
                                    type: object
                                  metadata:
                                    description: Rate limit on metadata.
                                    properties:
                                      defaultValue:
                                        description: |-
                                          An optional value to use if *metadata_key* is empty. If not set and
                                          no value is present under the metadata_key then no descriptor is generated.
                                        type: string
                                      descriptorKey:
                                        description: Required. The key to use in the
                                          descriptor entry.
                                        type: string
                                      metadataKey:
                                        description: |-
                                          Required. Metadata struct that defines the key and path to retrieve the string value. A match will
                                          only happen if the value in the metadata is of type string.
                                        properties:
                                          key:
                                            description: |-
                                              Required. The key name of Metadata to retrieve the Struct from the metadata.
                                              Typically, it represents a builtin subsystem or custom extension.
                                            type: string
                                          path:
                                            description: |-
                                              Must have at least one element. The path to retrieve the Value from the Struct. It can be a prefix or a full path,
                                              e.g. ``[prop, xyz]`` for a struct or ``[prop, foo]`` for a string in the example,
                                              which depends on the particular scenario.

                                              Note: Due to that only the key type segment is supported, the path can not specify a list
                                              unless the list is the last segment.
                                            items:
                                              oneOf:
                                              - not:
                                                  anyOf:
                                                  - required:
                                                    - key
                                              - required:
                                                - key
                                              properties:
                                                key:
                                                  description: Required. If specified,
                                                    use the key to retrieve the value
                                                    in a Struct.
                                                  type: string
                                              type: object
                                            type: array
                                        type: object
                                      source:
                                        description: Source of metadata
                                        enum:
                                        - DYNAMIC
                                        - ROUTE_ENTRY
                                        type: string
                                    type: object
                                  remoteAddress:
                                    description: Rate limit on remote address.
                                    type: object
                                  requestHeaders:
                                    description: Rate limit on request headers.
                                    properties:
                                      descriptorKey:
                                        description: The key to use in the descriptor
                                          entry.
                                        type: string
                                      headerName:
                                        description: |-
                                          The header name to be queried from the request headers. The header’s
                                          value is used to populate the value of the descriptor entry for the
                                          descriptor_key.
                                        type: string
                                    type: object
                                  sourceCluster:
                                    description: Rate limit on source cluster.
                                    type: object
                                type: object
                              type: array
                          type: object
                        type: array
                    type: object
                  serverSettings:
                    description: |-
                      Reference to the RatelimitServerSettings to use for this policy.
                      Currently routes on a single VirtualGateway or destination must share a single RatelimitServerSettings.
                      If none is provided, the default Gloo RatelimitServerSettings will be used.
                    properties:
                      cluster:
                        description: the cluster of the object. if the field is omitted,
                          Gloo Mesh will use the same cluster as the parent object
                          containing this reference.
                        type: string
                      name:
                        description: the name of the object
                        type: string
                      namespace:
                        description: the namespace of the object. if the field is
                          omitted, Gloo Mesh will use the same namespace as the parent
                          object containing this reference.
                        type: string
                    type: object
                type: object
            type: object
          status:
            description: Reflects the status of the RateLimitPolicy
            properties:
              global:
                properties:
                  message:
                    description: |-
                      Additional information about the current state of the resource across all
                      workspace clusters.
                    type: string
                  state:
                    description: |-
                      Whether the resource has been accepted as valid and processed in workspace
                      clusters that it exists in.
                    enum:
                    - PENDING
                    - ACCEPTED
                    - INVALID
                    - WARNING
                    - FAILED
                    - UNLICENSED
                    type: string
                type: object
              selectedDestinationPorts:
                description: Destination ports selected by the policy
                items:
                  properties:
                    kind:
                      description: the kind of destination being selected. defaults
                        to Kubernetes Service.
                      enum:
                      - SERVICE
                      - VIRTUAL_DESTINATION
                      - EXTERNAL_SERVICE
                      type: string
                    port:
                      description: the port on the destination object being targeted.
                        required if the object provides more than one port.
                      oneOf:
                      - not:
                          anyOf:
                          - required:
                            - number
                          - required:
                            - name
                      - required:
                        - number
                      - required:
                        - name
                      properties:
                        name:
                          description: the name of the port on the destination objects
                            being targeted.
                          type: string
                        number:
                          description: the number of the port on the destination objects
                            being targeted.
                          maximum: 4294967295
                          minimum: 0
                          type: integer
                      type: object
                    ref:
                      description: reference to the destination object by its metadata
                      properties:
                        cluster:
                          description: the cluster of the object. if the field is
                            omitted, Gloo Mesh will use the same cluster as the parent
                            object containing this reference.
                          type: string
                        name:
                          description: the name of the object
                          type: string
                        namespace:
                          description: the namespace of the object. if the field is
                            omitted, Gloo Mesh will use the same namespace as the
                            parent object containing this reference.
                          type: string
                      type: object
                    subset:
                      additionalProperties:
                        type: string
                      description: select a subset of the destination's endpoints
                        for routing based on their labels.
                      type: object
                    weight:
                      description: |-
                        Specify the proportion of traffic to be forwarded to this destination.
                        Weights across all of the `destinations` must sum to 100.
                        Weight is only relevant when used in the context of a route with multiple destinations.
                      maximum: 4294967295
                      minimum: 0
                      type: integer
                  type: object
                type: array
              selectedRoutes:
                description: Routes selected by the policy
                items:
                  properties:
                    routeIndex:
                      description: The index of the route on the route table
                      format: int32
                      type: integer
                    routeName:
                      description: The name of the route
                      type: string
                    routeTable:
                      description: The route table containing the route
                      properties:
                        cluster:
                          description: the cluster of the object. if the field is
                            omitted, Gloo Mesh will use the same cluster as the parent
                            object containing this reference.
                          type: string
                        name:
                          description: the name of the object
                          type: string
                        namespace:
                          description: the namespace of the object. if the field is
                            omitted, Gloo Mesh will use the same namespace as the
                            parent object containing this reference.
                          type: string
                      type: object
                  type: object
                type: array
              workspaces:
                additionalProperties:
                  properties:
                    clusters:
                      additionalProperties:
                        properties:
                          generic:
                            properties:
                              message:
                                description: Additional information about the current
                                  state of the resource.
                                type: string
                              observedGeneration:
                                description: |-
                                  The most recent generation observed in the the object's metadata.
                                  If the `observedGeneration` does not match `metadata.generation`, Gloo Mesh
                                  has not processed the most recent version of this object.
                                format: int64
                                type: integer
                              state:
                                description: |-
                                  Whether the resource has been accepted as valid and processed in the Gloo
                                  Mesh config translation.
                                enum:
                                - PENDING
                                - ACCEPTED
                                - INVALID
                                - WARNING
                                - FAILED
                                - UNLICENSED
                                type: string
                              updatedAt:
                                description: The last time the status was updated.
                                format: date-time
                                type: string
                            type: object
                        type: object
                      description: |-
                        The status of the resource in each cluster within the
                        workspace.
                      type: object
                  type: object
                description: The status of the resource in each workspace that it
                  exists in.
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    crd.solo.io/specHash: 676ede547ada0a3b
    crd.solo.io/version: 2.1.0
  labels:
    app: gloo-mesh-apis
    app.kubernetes.io/name: gloo-mesh-apis
  name: ratelimitclientconfigs.trafficcontrol.policy.gloo.solo.io
spec:
  group: trafficcontrol.policy.gloo.solo.io
  names:
    categories:
    - solo-io
    kind: RateLimitClientConfig
    listKind: RateLimitClientConfigList
    plural: ratelimitclientconfigs
    shortNames:
    - rlcc
    singular: ratelimitclientconfig
  scope: Namespaced
  versions:
  - name: v2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: |-
              RateLimitClientConfig is used to configure the ratelimit rules on routes/destinations.
              All RateLimitPolicy resources in a workspace require an RateLimitClientConfig to in order to function.
              If no RateLimitClientConfig is provided, no ratelimit rules will be enforced.
            oneOf:
            - not:
                anyOf:
                - required:
                  - raw
            - required:
              - raw
            properties:
              raw:
                description: Define a policy using the raw configuration format used
                  by the client (Envoy).
                properties:
                  rateLimits:
                    description: |-
                      Actions specify how the client (Envoy) will compose the descriptors that
                      will be sent to the server to make a rate limiting decision.
                    items:
                      properties:
                        actions:
                          items:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - sourceCluster
                                - required:
                                  - destinationCluster
                                - required:
                                  - requestHeaders
                                - required:
                                  - remoteAddress
                                - required:
                                  - genericKey
                                - required:
                                  - headerValueMatch
                                - required:
                                  - metadata
                            - required:
                              - sourceCluster
                            - required:
                              - destinationCluster
                            - required:
                              - requestHeaders
                            - required:
                              - remoteAddress
                            - required:
                              - genericKey
                            - required:
                              - headerValueMatch
                            - required:
                              - metadata
                            properties:
                              destinationCluster:
                                description: Rate limit on destination cluster.
                                type: object
                              genericKey:
                                description: Rate limit on a generic key.
                                properties:
                                  descriptorValue:
                                    description: The value to use in the descriptor
                                      entry.
                                    type: string
                                type: object
                              headerValueMatch:
                                description: Rate limit on the existence of request
                                  headers.
                                properties:
                                  descriptorValue:
                                    description: The value to use in the descriptor
                                      entry.
                                    type: string
                                  expectMatch:
                                    description: |-
                                      If set to true, the action will append a descriptor entry when the
                                      request matches the headers. If set to false, the action will append a
                                      descriptor entry when the request does not match the headers. The
                                      default value is true.
                                    nullable: true
                                    type: boolean
                                  headers:
                                    description: |-
                                      Specifies a set of headers that the rate limit action should match
                                      on. The action will check the request’s headers against all the
                                      specified headers in the config. A match will happen if all the
                                      headers in the config are present in the request with the same values
                                      (or based on presence if the value field is not in the config).
                                    items:
                                      oneOf:
                                      - not:
                                          anyOf:
                                          - required:
                                            - exactMatch
                                          - required:
                                            - regexMatch
                                          - required:
                                            - rangeMatch
                                          - required:
                                            - presentMatch
                                          - required:
                                            - prefixMatch
                                          - required:
                                            - suffixMatch
                                      - required:
                                        - exactMatch
                                      - required:
                                        - regexMatch
                                      - required:
                                        - rangeMatch
                                      - required:
                                        - presentMatch
                                      - required:
                                        - prefixMatch
                                      - required:
                                        - suffixMatch
                                      properties:
                                        exactMatch:
                                          description: If specified, header match
                                            will be performed based on the value of
                                            the header.
                                          type: string
                                        invertMatch:
                                          description: |-
                                            If specified, the match result will be inverted before checking. Defaults to false.

                                            Examples:

                                            * The regex *\d{3}* does not match the value *1234*, so it will match when inverted.
                                            * The range [-10,0) will match the value -1, so it will not match when inverted.
                                          type: boolean
                                        name:
                                          description: Specifies the name of the header
                                            in the request.
                                          type: string
                                        prefixMatch:
                                          description: |-
                                            If specified, header match will be performed based on the prefix of the header value.
                                            Note: empty prefix is not allowed, please use present_match instead.

                                            Examples:

                                            * The prefix *abcd* matches the value *abcdxyz*, but not for *abcxyz*.
                                          type: string
                                        presentMatch:
                                          description: |-
                                            If specified, header match will be performed based on whether the header is in the
                                            request.
                                          type: boolean
                                        rangeMatch:
                                          description: |-
                                            If specified, header match will be performed based on range.
                                            The rule will match if the request header value is within this range.
                                            The entire request header value must represent an integer in base 10 notation: consisting of
                                            an optional plus or minus sign followed by a sequence of digits. The rule will not match if
                                            the header value does not represent an integer. Match will fail for empty values, floating
                                            point numbers or if only a subsequence of the header value is an integer.

                                            Examples:

                                            * For range [-10,0), route will match for header value -1, but not for 0, "somestring", 10.9,
                                              "-1somestring"
                                          properties:
                                            end:
                                              description: end of the range (exclusive)
                                              format: int64
                                              type: integer
                                            start:
                                              description: start of the range (inclusive)
                                              format: int64
                                              type: integer
                                          type: object
                                        regexMatch:
                                          description: |-
                                            If specified, this regex string is a regular expression rule which implies the entire request
                                            header value must match the regex. The rule will not match if only a subsequence of the
                                            request header value matches the regex. The regex grammar used in the value field is defined
                                            `(here)[https://en.cppreference.com/w/cpp/regex/ecmascript]`.

                                            Examples:

                                            * The regex *\d{3}* matches the value *123*
                                            * The regex *\d{3}* does not match the value *1234*
                                            * The regex *\d{3}* does not match the value *123.456*
                                          type: string
                                        suffixMatch:
                                          description: |-
                                            If specified, header match will be performed based on the suffix of the header value.
                                            Note: empty suffix is not allowed, please use present_match instead.

                                            Examples:

                                            * The suffix *abcd* matches the value *xyzabcd*, but not for *xyzbcd*.
                                          type: string
                                      type: object
                                    type: array
                                type: object
                              metadata:
                                description: Rate limit on metadata.
                                properties:
                                  defaultValue:
                                    description: |-
                                      An optional value to use if *metadata_key* is empty. If not set and
                                      no value is present under the metadata_key then no descriptor is generated.
                                    type: string
                                  descriptorKey:
                                    description: Required. The key to use in the descriptor
                                      entry.
                                    type: string
                                  metadataKey:
                                    description: |-
                                      Required. Metadata struct that defines the key and path to retrieve the string value. A match will
                                      only happen if the value in the metadata is of type string.
                                    properties:
                                      key:
                                        description: |-
                                          Required. The key name of Metadata to retrieve the Struct from the metadata.
                                          Typically, it represents a builtin subsystem or custom extension.
                                        type: string
                                      path:
                                        description: |-
                                          Must have at least one element. The path to retrieve the Value from the Struct. It can be a prefix or a full path,
                                          e.g. ``[prop, xyz]`` for a struct or ``[prop, foo]`` for a string in the example,
                                          which depends on the particular scenario.

                                          Note: Due to that only the key type segment is supported, the path can not specify a list
                                          unless the list is the last segment.
                                        items:
                                          oneOf:
                                          - not:
                                              anyOf:
                                              - required:
                                                - key
                                          - required:
                                            - key
                                          properties:
                                            key:
                                              description: Required. If specified,
                                                use the key to retrieve the value
                                                in a Struct.
                                              type: string
                                          type: object
                                        type: array
                                    type: object
                                  source:
                                    description: Source of metadata
                                    enum:
                                    - DYNAMIC
                                    - ROUTE_ENTRY
                                    type: string
                                type: object
                              remoteAddress:
                                description: Rate limit on remote address.
                                type: object
                              requestHeaders:
                                description: Rate limit on request headers.
                                properties:
                                  descriptorKey:
                                    description: The key to use in the descriptor
                                      entry.
                                    type: string
                                  headerName:
                                    description: |-
                                      The header name to be queried from the request headers. The header’s
                                      value is used to populate the value of the descriptor entry for the
                                      descriptor_key.
                                    type: string
                                type: object
                              sourceCluster:
                                description: Rate limit on source cluster.
                                type: object
                            type: object
                          type: array
                        setActions:
                          items:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - sourceCluster
                                - required:
                                  - destinationCluster
                                - required:
                                  - requestHeaders
                                - required:
                                  - remoteAddress
                                - required:
                                  - genericKey
                                - required:
                                  - headerValueMatch
                                - required:
                                  - metadata
                            - required:
                              - sourceCluster
                            - required:
                              - destinationCluster
                            - required:
                              - requestHeaders
                            - required:
                              - remoteAddress
                            - required:
                              - genericKey
                            - required:
                              - headerValueMatch
                            - required:
                              - metadata
                            properties:
                              destinationCluster:
                                description: Rate limit on destination cluster.
                                type: object
                              genericKey:
                                description: Rate limit on a generic key.
                                properties:
                                  descriptorValue:
                                    description: The value to use in the descriptor
                                      entry.
                                    type: string
                                type: object
                              headerValueMatch:
                                description: Rate limit on the existence of request
                                  headers.
                                properties:
                                  descriptorValue:
                                    description: The value to use in the descriptor
                                      entry.
                                    type: string
                                  expectMatch:
                                    description: |-
                                      If set to true, the action will append a descriptor entry when the
                                      request matches the headers. If set to false, the action will append a
                                      descriptor entry when the request does not match the headers. The
                                      default value is true.
                                    nullable: true
                                    type: boolean
                                  headers:
                                    description: |-
                                      Specifies a set of headers that the rate limit action should match
                                      on. The action will check the request’s headers against all the
                                      specified headers in the config. A match will happen if all the
                                      headers in the config are present in the request with the same values
                                      (or based on presence if the value field is not in the config).
                                    items:
                                      oneOf:
                                      - not:
                                          anyOf:
                                          - required:
                                            - exactMatch
                                          - required:
                                            - regexMatch
                                          - required:
                                            - rangeMatch
                                          - required:
                                            - presentMatch
                                          - required:
                                            - prefixMatch
                                          - required:
                                            - suffixMatch
                                      - required:
                                        - exactMatch
                                      - required:
                                        - regexMatch
                                      - required:
                                        - rangeMatch
                                      - required:
                                        - presentMatch
                                      - required:
                                        - prefixMatch
                                      - required:
                                        - suffixMatch
                                      properties:
                                        exactMatch:
                                          description: If specified, header match
                                            will be performed based on the value of
                                            the header.
                                          type: string
                                        invertMatch:
                                          description: |-
                                            If specified, the match result will be inverted before checking. Defaults to false.

                                            Examples:

                                            * The regex *\d{3}* does not match the value *1234*, so it will match when inverted.
                                            * The range [-10,0) will match the value -1, so it will not match when inverted.
                                          type: boolean
                                        name:
                                          description: Specifies the name of the header
                                            in the request.
                                          type: string
                                        prefixMatch:
                                          description: |-
                                            If specified, header match will be performed based on the prefix of the header value.
                                            Note: empty prefix is not allowed, please use present_match instead.

                                            Examples:

                                            * The prefix *abcd* matches the value *abcdxyz*, but not for *abcxyz*.
                                          type: string
                                        presentMatch:
                                          description: |-
                                            If specified, header match will be performed based on whether the header is in the
                                            request.
                                          type: boolean
                                        rangeMatch:
                                          description: |-
                                            If specified, header match will be performed based on range.
                                            The rule will match if the request header value is within this range.
                                            The entire request header value must represent an integer in base 10 notation: consisting of
                                            an optional plus or minus sign followed by a sequence of digits. The rule will not match if
                                            the header value does not represent an integer. Match will fail for empty values, floating
                                            point numbers or if only a subsequence of the header value is an integer.

                                            Examples:

                                            * For range [-10,0), route will match for header value -1, but not for 0, "somestring", 10.9,
                                              "-1somestring"
                                          properties:
                                            end:
                                              description: end of the range (exclusive)
                                              format: int64
                                              type: integer
                                            start:
                                              description: start of the range (inclusive)
                                              format: int64
                                              type: integer
                                          type: object
                                        regexMatch:
                                          description: |-
                                            If specified, this regex string is a regular expression rule which implies the entire request
                                            header value must match the regex. The rule will not match if only a subsequence of the
                                            request header value matches the regex. The regex grammar used in the value field is defined
                                            `(here)[https://en.cppreference.com/w/cpp/regex/ecmascript]`.

                                            Examples:

                                            * The regex *\d{3}* matches the value *123*
                                            * The regex *\d{3}* does not match the value *1234*
                                            * The regex *\d{3}* does not match the value *123.456*
                                          type: string
                                        suffixMatch:
                                          description: |-
                                            If specified, header match will be performed based on the suffix of the header value.
                                            Note: empty suffix is not allowed, please use present_match instead.

                                            Examples:

                                            * The suffix *abcd* matches the value *xyzabcd*, but not for *xyzbcd*.
                                          type: string
                                      type: object
                                    type: array
                                type: object
                              metadata:
                                description: Rate limit on metadata.
                                properties:
                                  defaultValue:
                                    description: |-
                                      An optional value to use if *metadata_key* is empty. If not set and
                                      no value is present under the metadata_key then no descriptor is generated.
                                    type: string
                                  descriptorKey:
                                    description: Required. The key to use in the descriptor
                                      entry.
                                    type: string
                                  metadataKey:
                                    description: |-
                                      Required. Metadata struct that defines the key and path to retrieve the string value. A match will
                                      only happen if the value in the metadata is of type string.
                                    properties:
                                      key:
                                        description: |-
                                          Required. The key name of Metadata to retrieve the Struct from the metadata.
                                          Typically, it represents a builtin subsystem or custom extension.
                                        type: string
                                      path:
                                        description: |-
                                          Must have at least one element. The path to retrieve the Value from the Struct. It can be a prefix or a full path,
                                          e.g. ``[prop, xyz]`` for a struct or ``[prop, foo]`` for a string in the example,
                                          which depends on the particular scenario.

                                          Note: Due to that only the key type segment is supported, the path can not specify a list
                                          unless the list is the last segment.
                                        items:
                                          oneOf:
                                          - not:
                                              anyOf:
                                              - required:
                                                - key
                                          - required:
                                            - key
                                          properties:
                                            key:
                                              description: Required. If specified,
                                                use the key to retrieve the value
                                                in a Struct.
                                              type: string
                                          type: object
                                        type: array
                                    type: object
                                  source:
                                    description: Source of metadata
                                    enum:
                                    - DYNAMIC
                                    - ROUTE_ENTRY
                                    type: string
                                type: object
                              remoteAddress:
                                description: Rate limit on remote address.
                                type: object
                              requestHeaders:
                                description: Rate limit on request headers.
                                properties:
                                  descriptorKey:
                                    description: The key to use in the descriptor
                                      entry.
                                    type: string
                                  headerName:
                                    description: |-
                                      The header name to be queried from the request headers. The header’s
                                      value is used to populate the value of the descriptor entry for the
                                      descriptor_key.
                                    type: string
                                type: object
                              sourceCluster:
                                description: Rate limit on source cluster.
                                type: object
                            type: object
                          type: array
                      type: object
                    type: array
                type: object
            type: object
          status:
            description: The current status of the `RateLimitClientConfig`.
            properties:
              global:
                properties:
                  message:
                    description: |-
                      Additional information about the current state of the resource across all
                      workspace clusters.
                    type: string
                  state:
                    description: |-
                      Whether the resource has been accepted as valid and processed in workspace
                      clusters that it exists in.
                    enum:
                    - PENDING
                    - ACCEPTED
                    - INVALID
                    - WARNING
                    - FAILED
                    - UNLICENSED
                    type: string
                type: object
              workspaces:
                additionalProperties:
                  properties:
                    clusters:
                      additionalProperties:
                        properties:
                          generic:
                            properties:
                              message:
                                description: Additional information about the current
                                  state of the resource.
                                type: string
                              observedGeneration:
                                description: |-
                                  The most recent generation observed in the the object's metadata.
                                  If the `observedGeneration` does not match `metadata.generation`, Gloo Mesh
                                  has not processed the most recent version of this object.
                                format: int64
                                type: integer
                              state:
                                description: |-
                                  Whether the resource has been accepted as valid and processed in the Gloo
                                  Mesh config translation.
                                enum:
                                - PENDING
                                - ACCEPTED
                                - INVALID
                                - WARNING
                                - FAILED
                                - UNLICENSED
                                type: string
                              updatedAt:
                                description: The last time the status was updated.
                                format: date-time
                                type: string
                            type: object
                        type: object
                      description: |-
                        The status of the resource in each cluster within the
                        workspace.
                      type: object
                  type: object
                description: The status of the resource in each workspace that it
                  exists in.
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    crd.solo.io/specHash: aa75fdc69ff41da
    crd.solo.io/version: 2.1.0
  labels:
    app: gloo-mesh-apis
    app.kubernetes.io/name: gloo-mesh-apis
  name: headermanipulationpolicies.trafficcontrol.policy.gloo.solo.io
spec:
  group: trafficcontrol.policy.gloo.solo.io
  names:
    categories:
    - solo-io
    kind: HeaderManipulationPolicy
    listKind: HeaderManipulationPolicyList
    plural: headermanipulationpolicies
    shortNames:
    - hmp
    singular: headermanipulationpolicy
  scope: Namespaced
  versions:
  - name: v2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: |-
              HeaderManipulationPolicy is used to transform HTTP requests and responses matching selected routes.
              TransformationPolicies are applied at the *Route* level.
              If no selectors are provided, will apply to all routes in the workspace.
            properties:
              applyToRouteDestinations:
                description: |-
                  Select routes' destinations where the policy will be applied.
                  This field is intended for when the config should be applied to a `forwardTo` route only when
                  it is forwarded to a subset of the route's backing destinations.
                items:
                  properties:
                    onDestinations:
                      description: for the selected routes, select destinations on
                        which to apply this policy
                      items:
                        properties:
                          kind:
                            description: the kind of destination being selected. defaults
                              to Kubernetes Service.
                            enum:
                            - SERVICE
                            - VIRTUAL_DESTINATION
                            - EXTERNAL_SERVICE
                            type: string
                          port:
                            description: |-
                              the port on the Destination which receives traffic.
                              Not required if the Destination only exposes a single port.
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - number
                                - required:
                                  - name
                            - required:
                              - number
                            - required:
                              - name
                            properties:
                              name:
                                description: the name of the port on the destination
                                  objects being targeted.
                                type: string
                              number:
                                description: the number of the port on the destination
                                  objects being targeted.
                                maximum: 4294967295
                                minimum: 0
                                type: integer
                            type: object
                          selector:
                            description: selector used to match destination objects
                              by their metadata
                            properties:
                              cluster:
                                description: |-
                                  Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                                  matching objects across all clusters available in the parent object's workspace.
                                type: string
                              labels:
                                additionalProperties:
                                  type: string
                                description: labels matching those of the object
                                type: object
                              name:
                                description: |-
                                  Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                                  matching objects with any name available in the parent object's workspace.
                                type: string
                              namespace:
                                description: |-
                                  Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                                  matching objects across all namespaces available in the parent object's workspace.
                                type: string
                              workspace:
                                description: |-
                                  Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                                  matching objects across all workspaces available in the parent object's workspace.
                                type: string
                            type: object
                        type: object
                      type: array
                    route:
                      description: |-
                        select routes based on their labels.
                        these labels can be used to match route tables or individual routes within route tables.
                        if left empty, configuration will apply to all specified destinations on all routes in the workspace.
                      properties:
                        cluster:
                          description: |-
                            Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                            matching objects across all clusters available in the parent object's workspace.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: labels matching those of the object
                          type: object
                        name:
                          description: |-
                            Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                            matching objects with any name available in the parent object's workspace.
                          type: string
                        namespace:
                          description: |-
                            Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                            matching objects across all namespaces available in the parent object's workspace.
                          type: string
                        workspace:
                          description: |-
                            Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                            matching objects across all workspaces available in the parent object's workspace.
                          type: string
                      type: object
                  type: object
                type: array
              applyToRoutes:
                description: select the routes where the policy will be applied
                items:
                  oneOf:
                  - not:
                      anyOf:
                      - required:
                        - route
                      - required:
                        - withDestinations
                  - required:
                    - route
                  - required:
                    - withDestinations
                  properties:
                    route:
                      description: |-
                        select routes based on their labels.
                        these labels can be used to match route tables or individual routes within route tables.
                      properties:
                        cluster:
                          description: |-
                            Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                            matching objects across all clusters available in the parent object's workspace.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: labels matching those of the object
                          type: object
                        name:
                          description: |-
                            Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                            matching objects with any name available in the parent object's workspace.
                          type: string
                        namespace:
                          description: |-
                            Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                            matching objects across all namespaces available in the parent object's workspace.
                          type: string
                        workspace:
                          description: |-
                            Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                            matching objects across all workspaces available in the parent object's workspace.
                          type: string
                      type: object
                    withDestinations:
                      description: |-
                        select routes with `forwardTo` actions based on their destinations.
                        this can be used to apply policy to routes regardless of
                        their labels
                      properties:
                        kind:
                          description: the kind of destination being selected. defaults
                            to Kubernetes Service.
                          enum:
                          - SERVICE
                          - VIRTUAL_DESTINATION
                          - EXTERNAL_SERVICE
                          type: string
                        port:
                          description: |-
                            the port on the Destination which receives traffic.
                            Not required if the Destination only exposes a single port.
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - number
                              - required:
                                - name
                          - required:
                            - number
                          - required:
                            - name
                          properties:
                            name:
                              description: the name of the port on the destination
                                objects being targeted.
                              type: string
                            number:
                              description: the number of the port on the destination
                                objects being targeted.
                              maximum: 4294967295
                              minimum: 0
                              type: integer
                          type: object
                        selector:
                          description: selector used to match destination objects
                            by their metadata
                          properties:
                            cluster:
                              description: |-
                                Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                                matching objects across all clusters available in the parent object's workspace.
                              type: string
                            labels:
                              additionalProperties:
                                type: string
                              description: labels matching those of the object
                              type: object
                            name:
                              description: |-
                                Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                                matching objects with any name available in the parent object's workspace.
                              type: string
                            namespace:
                              description: |-
                                Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                                matching objects across all namespaces available in the parent object's workspace.
                              type: string
                            workspace:
                              description: |-
                                Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                                matching objects across all workspaces available in the parent object's workspace.
                              type: string
                          type: object
                      type: object
                  type: object
                type: array
              config:
                description: The details of the transformation policy to apply to
                  the selected routes or destinations for a given route.
                properties:
                  appendRequestHeaders:
                    additionalProperties:
                      type: string
                    description: Additional HTTP headers to add before forwarding
                      a request to the destination service.
                    type: object
                  appendResponseHeaders:
                    additionalProperties:
                      type: string
                    description: Additional HTTP headers to add before returning a
                      response to the caller.
                    type: object
                  removeRequestHeaders:
                    description: HTTP headers to remove before forwarding a request
                      to the destination service.
                    items:
                      type: string
                    type: array
                  removeResponseHeaders:
                    description: HTTP headers to remove before returning a response
                      to the caller.
                    items:
                      type: string
                    type: array
                type: object
            type: object
          status:
            description: reflects the status of the HeaderManipulationPolicy
            properties:
              global:
                properties:
                  message:
                    description: |-
                      Additional information about the current state of the resource across all
                      workspace clusters.
                    type: string
                  state:
                    description: |-
                      Whether the resource has been accepted as valid and processed in workspace
                      clusters that it exists in.
                    enum:
                    - PENDING
                    - ACCEPTED
                    - INVALID
                    - WARNING
                    - FAILED
                    - UNLICENSED
                    type: string
                type: object
              selectedRoutes:
                description: Routes selected by the policy
                items:
                  properties:
                    routeIndex:
                      description: The index of the route on the route table
                      format: int32
                      type: integer
                    routeName:
                      description: The name of the route
                      type: string
                    routeTable:
                      description: The route table containing the route
                      properties:
                        cluster:
                          description: the cluster of the object. if the field is
                            omitted, Gloo Mesh will use the same cluster as the parent
                            object containing this reference.
                          type: string
                        name:
                          description: the name of the object
                          type: string
                        namespace:
                          description: the namespace of the object. if the field is
                            omitted, Gloo Mesh will use the same namespace as the
                            parent object containing this reference.
                          type: string
                      type: object
                  type: object
                type: array
              workspaces:
                additionalProperties:
                  properties:
                    clusters:
                      additionalProperties:
                        properties:
                          generic:
                            properties:
                              message:
                                description: Additional information about the current
                                  state of the resource.
                                type: string
                              observedGeneration:
                                description: |-
                                  The most recent generation observed in the the object's metadata.
                                  If the `observedGeneration` does not match `metadata.generation`, Gloo Mesh
                                  has not processed the most recent version of this object.
                                format: int64
                                type: integer
                              state:
                                description: |-
                                  Whether the resource has been accepted as valid and processed in the Gloo
                                  Mesh config translation.
                                enum:
                                - PENDING
                                - ACCEPTED
                                - INVALID
                                - WARNING
                                - FAILED
                                - UNLICENSED
                                type: string
                              updatedAt:
                                description: The last time the status was updated.
                                format: date-time
                                type: string
                            type: object
                        type: object
                      description: |-
                        The status of the resource in each cluster within the
                        workspace.
                      type: object
                  type: object
                description: The status of the resource in each workspace that it
                  exists in.
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    crd.solo.io/specHash: a29e76c302dad52a
    crd.solo.io/version: 2.1.0
  labels:
    app: gloo-mesh-apis
    app.kubernetes.io/name: gloo-mesh-apis
  name: transformationpolicies.trafficcontrol.policy.gloo.solo.io
spec:
  group: trafficcontrol.policy.gloo.solo.io
  names:
    categories:
    - solo-io
    kind: TransformationPolicy
    listKind: TransformationPolicyList
    plural: transformationpolicies
    shortNames:
    - tp
    singular: transformationpolicy
  scope: Namespaced
  versions:
  - name: v2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: |-
              TransformationPolicy is used to transform HTTP requests and responses matching selected routes.
              TransformationPolicies are applied at the *Route* level.
            properties:
              applyToRoutes:
                description: |-
                  select the routes where the policy will be applied
                  if left empty, will apply to all routes in the workspace.
                items:
                  oneOf:
                  - not:
                      anyOf:
                      - required:
                        - route
                      - required:
                        - withDestinations
                  - required:
                    - route
                  - required:
                    - withDestinations
                  properties:
                    route:
                      description: |-
                        select routes based on their labels.
                        these labels can be used to match route tables or individual routes within route tables.
                      properties:
                        cluster:
                          description: |-
                            Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                            matching objects across all clusters available in the parent object's workspace.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: labels matching those of the object
                          type: object
                        name:
                          description: |-
                            Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                            matching objects with any name available in the parent object's workspace.
                          type: string
                        namespace:
                          description: |-
                            Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                            matching objects across all namespaces available in the parent object's workspace.
                          type: string
                        workspace:
                          description: |-
                            Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                            matching objects across all workspaces available in the parent object's workspace.
                          type: string
                      type: object
                    withDestinations:
                      description: |-
                        select routes with `forwardTo` actions based on their destinations.
                        this can be used to apply policy to routes regardless of
                        their labels
                      properties:
                        kind:
                          description: the kind of destination being selected. defaults
                            to Kubernetes Service.
                          enum:
                          - SERVICE
                          - VIRTUAL_DESTINATION
                          - EXTERNAL_SERVICE
                          type: string
                        port:
                          description: |-
                            the port on the Destination which receives traffic.
                            Not required if the Destination only exposes a single port.
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - number
                              - required:
                                - name
                          - required:
                            - number
                          - required:
                            - name
                          properties:
                            name:
                              description: the name of the port on the destination
                                objects being targeted.
                              type: string
                            number:
                              description: the number of the port on the destination
                                objects being targeted.
                              maximum: 4294967295
                              minimum: 0
                              type: integer
                          type: object
                        selector:
                          description: selector used to match destination objects
                            by their metadata
                          properties:
                            cluster:
                              description: |-
                                Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                                matching objects across all clusters available in the parent object's workspace.
                              type: string
                            labels:
                              additionalProperties:
                                type: string
                              description: labels matching those of the object
                              type: object
                            name:
                              description: |-
                                Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                                matching objects with any name available in the parent object's workspace.
                              type: string
                            namespace:
                              description: |-
                                Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                                matching objects across all namespaces available in the parent object's workspace.
                              type: string
                            workspace:
                              description: |-
                                Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                                matching objects across all workspaces available in the parent object's workspace.
                              type: string
                          type: object
                      type: object
                  type: object
                type: array
              config:
                description: The details of the transformation policy to apply to
                  the selected routes.
                properties:
                  phase:
                    description: |-
                      Specify the phase to indicate where this policy should be applied relative to other policies.
                      If no phase is specified, the default will be post AuthZ.
                    oneOf:
                    - not:
                        anyOf:
                        - required:
                          - preAuthz
                        - required:
                          - postAuthz
                    - required:
                      - preAuthz
                    - required:
                      - postAuthz
                    properties:
                      postAuthz:
                        description: Apply this policy after Authorization policies
                          are applied.
                        properties:
                          priority:
                            description: |-
                              The priority at which this policy should be applied relative to other policies defined in the same phase.
                              The lowest priority will be run first and the default priority value is 0.
                            maximum: 2147483647
                            minimum: -2147483648
                            nullable: true
                            type: integer
                        type: object
                      preAuthz:
                        description: Apply this policy before Authorization policies
                          are applied.
                        properties:
                          priority:
                            description: |-
                              The priority at which this policy should be applied relative to other policies defined in the same phase.
                              The lowest priority will be run first and the default priority value is 0.
                            maximum: 2147483647
                            minimum: -2147483648
                            nullable: true
                            type: integer
                        type: object
                    type: object
                  request:
                    description: Transformation to be applied before the request is
                      sent to the upstream service.
                    properties:
                      injaTemplate:
                        description: transform HTTP body and headers using Inja templates.
                        oneOf:
                        - not:
                            anyOf:
                            - required:
                              - body
                            - required:
                              - passthrough
                            - required:
                              - mergeExtractorsToBody
                        - required:
                          - body
                        - required:
                          - passthrough
                        - required:
                          - mergeExtractorsToBody
                        properties:
                          advancedTemplates:
                            description: |-
                              If set to true, use JSON pointer notation (e.g. "time/start") instead of
                              dot notation (e.g. "time.start") to access JSON elements. Defaults to
                              false.

                              Please note that, if set to 'true', you will need to use the `extraction`
                              function to access extractors in the template (e.g. '{{
                              extraction("my_extractor") }}'); if the default value of 'false' is used,
                              extractors will simply be available by their name (e.g. '{{ my_extractor
                              }}').
                            type: boolean
                          body:
                            description: Apply a template to the body
                            properties:
                              text:
                                type: string
                            type: object
                          dynamicMetadataValues:
                            description: Use this field to set Dynamic Metadata.
                            items:
                              properties:
                                key:
                                  description: The metadata key.
                                  type: string
                                metadataNamespace:
                                  description: The metadata namespace. Defaults to
                                    the filter namespace.
                                  type: string
                                value:
                                  description: A template that determines the metadata
                                    value.
                                  properties:
                                    text:
                                      type: string
                                  type: object
                              type: object
                            type: array
                          extractors:
                            additionalProperties:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - header
                                  - required:
                                    - body
                              - required:
                                - header
                              - required:
                                - body
                              properties:
                                body:
                                  description: Extract information from the request/response
                                    body
                                  maxProperties: 0
                                  type: object
                                header:
                                  description: Extract information from headers
                                  type: string
                                regex:
                                  description: |-
                                    Only strings matching this regular expression will be part of the
                                    extraction. The most simple value for this field is '.*', which matches the
                                    whole source. The field is required. If extraction fails the result is an
                                    empty value.
                                  type: string
                                subgroup:
                                  description: |-
                                    If your regex contains capturing groups, use this field to determine which
                                    group should be selected.
                                  maximum: 4294967295
                                  minimum: 0
                                  type: integer
                              type: object
                            description: |-
                              Use this attribute to extract information from the request. It consists of
                              a map of strings to extractors. The extractor will defines which
                              information will be extracted, while the string key will provide the
                              extractor with a name. You can reference extractors by their name in
                              templates, e.g. "{{ my-extractor }}" will render to the value of the
                              "my-extractor" extractor.
                            type: object
                          headers:
                            additionalProperties:
                              properties:
                                text:
                                  type: string
                              type: object
                            description: |-
                              Use this attribute to transform request/response headers. It consists of a
                              map of strings to templates. The string key determines the name of the
                              resulting header, the rendered template will determine the value. Any existing
                              headers with the same header name will be replaced by the transformed header.
                              If a header name is included in `headers` and `headers_to_append`, it will first
                              be replaced the template in `headers`, then additional header values will be appended
                              by the templates defined in `headers_to_append`.
                            type: object
                          headersToAppend:
                            description: |-
                              Use this attribute to transform request/response headers. It consists of
                              an array of string/template objects. Use this attribute to define multiple
                              templates for a single header. Header template(s) defined here will be appended to any
                              existing headers with the same header name, not replace existing ones.
                            items:
                              properties:
                                key:
                                  description: Header name
                                  type: string
                                value:
                                  description: Apply a template to the header value
                                  properties:
                                    text:
                                      type: string
                                  type: object
                              type: object
                            type: array
                          ignoreErrorOnParse:
                            description: |-
                              If set to true, Envoy will not throw an exception in case the body parsing
                              fails.
                            type: boolean
                          mergeExtractorsToBody:
                            description: |-
                              Merge all defined extractors to the request/response body.
                              If you want to nest elements inside the body, use dot separator in the
                              extractor name.
                            type: object
                          parseBodyBehavior:
                            enum:
                            - ParseAsJson
                            - DontParse
                            type: string
                          passthrough:
                            description: |-
                              This will cause the transformation filter not to buffer the body.
                              Use this setting if the response body is large and you don't need to
                              transform nor extract information from it.
                            type: object
                        type: object
                      recalculateRoutingDestination:
                        description: |-
                          If the request was transformed such that it would match a different route,
                          recalculate the routing destination (select a new route) based on the transformed content of the request.
                        type: boolean
                    type: object
                  response:
                    description: Transform the response received from the upstream
                      servidce before returning it to the client.
                    properties:
                      injaTemplate:
                        description: transform response body and headers using Inja
                          templates
                        oneOf:
                        - not:
                            anyOf:
                            - required:
                              - body
                            - required:
                              - passthrough
                            - required:
                              - mergeExtractorsToBody
                        - required:
                          - body
                        - required:
                          - passthrough
                        - required:
                          - mergeExtractorsToBody
                        properties:
                          advancedTemplates:
                            description: |-
                              If set to true, use JSON pointer notation (e.g. "time/start") instead of
                              dot notation (e.g. "time.start") to access JSON elements. Defaults to
                              false.

                              Please note that, if set to 'true', you will need to use the `extraction`
                              function to access extractors in the template (e.g. '{{
                              extraction("my_extractor") }}'); if the default value of 'false' is used,
                              extractors will simply be available by their name (e.g. '{{ my_extractor
                              }}').
                            type: boolean
                          body:
                            description: Apply a template to the body
                            properties:
                              text:
                                type: string
                            type: object
                          dynamicMetadataValues:
                            description: Use this field to set Dynamic Metadata.
                            items:
                              properties:
                                key:
                                  description: The metadata key.
                                  type: string
                                metadataNamespace:
                                  description: The metadata namespace. Defaults to
                                    the filter namespace.
                                  type: string
                                value:
                                  description: A template that determines the metadata
                                    value.
                                  properties:
                                    text:
                                      type: string
                                  type: object
                              type: object
                            type: array
                          extractors:
                            additionalProperties:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - header
                                  - required:
                                    - body
                              - required:
                                - header
                              - required:
                                - body
                              properties:
                                body:
                                  description: Extract information from the request/response
                                    body
                                  maxProperties: 0
                                  type: object
                                header:
                                  description: Extract information from headers
                                  type: string
                                regex:
                                  description: |-
                                    Only strings matching this regular expression will be part of the
                                    extraction. The most simple value for this field is '.*', which matches the
                                    whole source. The field is required. If extraction fails the result is an
                                    empty value.
                                  type: string
                                subgroup:
                                  description: |-
                                    If your regex contains capturing groups, use this field to determine which
                                    group should be selected.
                                  maximum: 4294967295
                                  minimum: 0
                                  type: integer
                              type: object
                            description: |-
                              Use this attribute to extract information from the request. It consists of
                              a map of strings to extractors. The extractor will defines which
                              information will be extracted, while the string key will provide the
                              extractor with a name. You can reference extractors by their name in
                              templates, e.g. "{{ my-extractor }}" will render to the value of the
                              "my-extractor" extractor.
                            type: object
                          headers:
                            additionalProperties:
                              properties:
                                text:
                                  type: string
                              type: object
                            description: |-
                              Use this attribute to transform request/response headers. It consists of a
                              map of strings to templates. The string key determines the name of the
                              resulting header, the rendered template will determine the value. Any existing
                              headers with the same header name will be replaced by the transformed header.
                              If a header name is included in `headers` and `headers_to_append`, it will first
                              be replaced the template in `headers`, then additional header values will be appended
                              by the templates defined in `headers_to_append`.
                            type: object
                          headersToAppend:
                            description: |-
                              Use this attribute to transform request/response headers. It consists of
                              an array of string/template objects. Use this attribute to define multiple
                              templates for a single header. Header template(s) defined here will be appended to any
                              existing headers with the same header name, not replace existing ones.
                            items:
                              properties:
                                key:
                                  description: Header name
                                  type: string
                                value:
                                  description: Apply a template to the header value
                                  properties:
                                    text:
                                      type: string
                                  type: object
                              type: object
                            type: array
                          ignoreErrorOnParse:
                            description: |-
                              If set to true, Envoy will not throw an exception in case the body parsing
                              fails.
                            type: boolean
                          mergeExtractorsToBody:
                            description: |-
                              Merge all defined extractors to the request/response body.
                              If you want to nest elements inside the body, use dot separator in the
                              extractor name.
                            type: object
                          parseBodyBehavior:
                            enum:
                            - ParseAsJson
                            - DontParse
                            type: string
                          passthrough:
                            description: |-
                              This will cause the transformation filter not to buffer the body.
                              Use this setting if the response body is large and you don't need to
                              transform nor extract information from it.
                            type: object
                        type: object
                    type: object
                type: object
            type: object
          status:
            description: reflects the status of the TransformationPolicy
            properties:
              global:
                properties:
                  message:
                    description: |-
                      Additional information about the current state of the resource across all
                      workspace clusters.
                    type: string
                  state:
                    description: |-
                      Whether the resource has been accepted as valid and processed in workspace
                      clusters that it exists in.
                    enum:
                    - PENDING
                    - ACCEPTED
                    - INVALID
                    - WARNING
                    - FAILED
                    - UNLICENSED
                    type: string
                type: object
              selectedRoutes:
                description: Routes selected by the policy
                items:
                  properties:
                    routeIndex:
                      description: The index of the route on the route table
                      format: int32
                      type: integer
                    routeName:
                      description: The name of the route
                      type: string
                    routeTable:
                      description: The route table containing the route
                      properties:
                        cluster:
                          description: the cluster of the object. if the field is
                            omitted, Gloo Mesh will use the same cluster as the parent
                            object containing this reference.
                          type: string
                        name:
                          description: the name of the object
                          type: string
                        namespace:
                          description: the namespace of the object. if the field is
                            omitted, Gloo Mesh will use the same namespace as the
                            parent object containing this reference.
                          type: string
                      type: object
                  type: object
                type: array
              workspaces:
                additionalProperties:
                  properties:
                    clusters:
                      additionalProperties:
                        properties:
                          generic:
                            properties:
                              message:
                                description: Additional information about the current
                                  state of the resource.
                                type: string
                              observedGeneration:
                                description: |-
                                  The most recent generation observed in the the object's metadata.
                                  If the `observedGeneration` does not match `metadata.generation`, Gloo Mesh
                                  has not processed the most recent version of this object.
                                format: int64
                                type: integer
                              state:
                                description: |-
                                  Whether the resource has been accepted as valid and processed in the Gloo
                                  Mesh config translation.
                                enum:
                                - PENDING
                                - ACCEPTED
                                - INVALID
                                - WARNING
                                - FAILED
                                - UNLICENSED
                                type: string
                              updatedAt:
                                description: The last time the status was updated.
                                format: date-time
                                type: string
                            type: object
                        type: object
                      description: |-
                        The status of the resource in each cluster within the
                        workspace.
                      type: object
                  type: object
                description: The status of the resource in each workspace that it
                  exists in.
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    crd.solo.io/specHash: 14e505b47bca7a18
    crd.solo.io/version: 2.1.0
  labels:
    app: gloo-mesh-apis
    app.kubernetes.io/name: gloo-mesh-apis
  name: proxyprotocolpolicies.trafficcontrol.policy.gloo.solo.io
spec:
  group: trafficcontrol.policy.gloo.solo.io
  names:
    categories:
    - solo-io
    kind: ProxyProtocolPolicy
    listKind: ProxyProtocolPolicyList
    plural: proxyprotocolpolicies
    singular: proxyprotocolpolicy
  scope: Namespaced
  versions:
  - name: v2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: |-
              ProxyProtocolPolicy is used to enable proxy protocol for gateway listener(s).

              For more details on ProxyProtocol, visit:
              https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt

              ```
              apiVersion: trafficcontrol.policy.gloo.solo.io/v2
              kind: ProxyProtocolPolicy
              metadata:
                name: my-policy
                namespace: bookinfo
              spec:
                config:
                  enabledProxyProtocol: true
                applyToListeners:
                - virtualGateway:
                    name: virtual-gateway
                    namespace: bookinfo
                    cluster: my-cluster
                  port:
                    number: 443
              ```
            properties:
              applyToListeners:
                description: 'Required: The VirtualGateway(s) and Port(s) to which
                  this policy applies.'
                items:
                  properties:
                    port:
                      oneOf:
                      - not:
                          anyOf:
                          - required:
                            - number
                          - required:
                            - name
                      - required:
                        - number
                      - required:
                        - name
                      properties:
                        name:
                          description: the name of the port on the destination objects
                            being targeted.
                          type: string
                        number:
                          description: the number of the port on the destination objects
                            being targeted.
                          maximum: 4294967295
                          minimum: 0
                          type: integer
                      type: object
                    virtualGateway:
                      properties:
                        cluster:
                          description: |-
                            Only select objects in the matching cluster. If the field is omitted, Gloo Mesh will select
                            matching objects across all clusters available in the parent object's workspace.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: labels matching those of the object
                          type: object
                        name:
                          description: |-
                            Only select objects with the matching name. If the field is omitted, Gloo Mesh will select
                            matching objects with any name available in the parent object's workspace.
                          type: string
                        namespace:
                          description: |-
                            Only select objects in the matching namespace. If the field is omitted, Gloo Mesh will select
                            matching objects across all namespaces available in the parent object's workspace.
                          type: string
                        workspace:
                          description: |-
                            Only select objects in the given workspace. If the field is omitted, Gloo Mesh will select
                            matching objects across all workspaces available in the parent object's workspace.
                          type: string
                      type: object
                  type: object
                type: array
              config:
                description: 'Required: The configuration to apply to the listener.'
                properties:
                  enableProxyProtocol:
                    type: boolean
                type: object
            type: object
          status:
            description: reflects the status of the ProxyProtocolPolicy
            properties:
              observedGeneration:
                description: |-
                  The most recent generation observed in the the object's metadata.
                  If the `observedGeneration` does not match `metadata.generation`, Gloo Mesh
                  has not processed the most recent version of this object.
                format: int64
                type: integer
              state:
                description: |-
                  Whether the resource has been accepted as valid and processed in the Gloo
                  Mesh config translation.
                enum:
                - PENDING
                - ACCEPTED
                - INVALID
                - WARNING
                - FAILED
                - UNLICENSED
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
